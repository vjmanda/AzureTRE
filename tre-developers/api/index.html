
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Azure TRE">
      
      
        <meta name="author" content="Microsoft">
      
      
        <link rel="canonical" href="https://github.com/microsoft/AzureTRE/tre-developers/api/">
      
      <link rel="icon" href="../../assets/ms_icon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.6">
    
    
      
        <title>API - Azure TRE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "7gescazz1m");
</script>

    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tre-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Azure TRE" class="md-header__button md-logo" aria-label="Azure TRE" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azure TRE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/AzureTre/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Azure TRE" class="md-nav__button md-logo" aria-label="Azure TRE" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    Azure TRE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/AzureTre/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../..">Azure TRE Overview</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Azure TRE Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Azure TRE Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/user-roles/" class="md-nav__link">
        User Roles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/networking/" class="md-nav__link">
        Network Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/tre-resources-breakdown/" class="md-nav__link">
        Azure Resource Breakdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_6">
          Shared Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Shared Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          Shared Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/shared-services/gitea/" class="md-nav__link">
        Gitea (Source Mirror)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/shared-services/nexus/" class="md-nav__link">
        Nexus (Package Mirror)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          TRE Admins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TRE Admins" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          TRE Admins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Setup Instructions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setup Instructions" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Setup Instructions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/getting-started/" class="md-nav__link">
        1. Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/pre-deployment-steps/" class="md-nav__link">
        2. Pre-deployment Steps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/deploying-azure-tre/" class="md-nav__link">
        3. Deploying Azure TRE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/workflows/" class="md-nav__link">
        3b. Deploying Azure TRE with GitHub workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/configuring-shared-services/" class="md-nav__link">
        4. Configuring Shared Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/installing-base-workspace/" class="md-nav__link">
        5. Installing Base Workspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/setup-instructions/installing-workspace-service-and-user-resource/" class="md-nav__link">
        6. Installing Workspace Service and User Resource
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/start-stop/" class="md-nav__link">
        Start-stop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/tear-down/" class="md-nav__link">
        Tear-down
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/environment-variables/" class="md-nav__link">
        Environment Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/auth/" class="md-nav__link">
        Authentication and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/registering-templates/" class="md-nav__link">
        Registering Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-admins/troubleshooting-guide/" class="md-nav__link">
        Troubleshooting Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">TRE Developers</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="TRE Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          TRE Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-resources" class="md-nav__link">
    Azure resources
  </a>
  
    <nav class="md-nav" aria-label="Azure resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-resources-bash" class="md-nav__link">
    Creating resources (Bash)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-authorization" class="md-nav__link">
    Authentication and Authorization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-store" class="md-nav__link">
    State store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-bus" class="md-nav__link">
    Service Bus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-and-monitoring" class="md-nav__link">
    Logging and monitoring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-principal-for-api-process-identity" class="md-nav__link">
    Service principal for API process identity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-api" class="md-nav__link">
    Running the API
  </a>
  
    <nav class="md-nav" aria-label="Running the API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#develop-and-run-locally" class="md-nav__link">
    Develop and run locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#develop-and-run-in-a-dev-container" class="md-nav__link">
    Develop and run in a dev container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-with-docker" class="md-nav__link">
    Deploy with Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    Unit tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-application-folder-structure" class="md-nav__link">
    API application folder structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auth-in-code" class="md-nav__link">
    Auth in code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auth-in-workspace-requests" class="md-nav__link">
    Auth in workspace requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-requirements" class="md-nav__link">
    Network requirements
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resource-processor/" class="md-nav__link">
        Resource Processor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../end-to-end-tests/" class="md-nav__link">
        End to End Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          TRE Workspace Authors
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TRE Workspace Authors" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          TRE Workspace Authors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-workspace-authors/authoring-workspace-templates/" class="md-nav__link">
        Authoring Workspace Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-workspace-authors/firewall-rules/" class="md-nav__link">
        Firewall Rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Templates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Templates" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Templates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Workspaces
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workspaces" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Workspaces
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspaces/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspaces/inner-eye/" class="md-nav__link">
        InnerEye
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Workspace Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workspace Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Workspace Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/azure-ml/" class="md-nav__link">
        Azure ML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/dev-test-labs/" class="md-nav__link">
        DevTest Labs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/gitea/" class="md-nav__link">
        Gitea
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/guacamole/" class="md-nav__link">
        Guacamole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/inner-eye/" class="md-nav__link">
        InnerEye
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3">
          User Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Resources" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          User Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/user-resources/guacamole-windows-vm/" class="md-nav__link">
        Guacamole Windows VM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/user-resources/guacamole-linux-vm/" class="md-nav__link">
        Guacamole Linux VM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tools" class="md-nav__link">
    Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-resources" class="md-nav__link">
    Azure resources
  </a>
  
    <nav class="md-nav" aria-label="Azure resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-resources-bash" class="md-nav__link">
    Creating resources (Bash)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-and-authorization" class="md-nav__link">
    Authentication and Authorization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-store" class="md-nav__link">
    State store
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-bus" class="md-nav__link">
    Service Bus
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-and-monitoring" class="md-nav__link">
    Logging and monitoring
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-principal-for-api-process-identity" class="md-nav__link">
    Service principal for API process identity
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-api" class="md-nav__link">
    Running the API
  </a>
  
    <nav class="md-nav" aria-label="Running the API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#develop-and-run-locally" class="md-nav__link">
    Develop and run locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#develop-and-run-in-a-dev-container" class="md-nav__link">
    Develop and run in a dev container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-with-docker" class="md-nav__link">
    Deploy with Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unit-tests" class="md-nav__link">
    Unit tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-application-folder-structure" class="md-nav__link">
    API application folder structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auth-in-code" class="md-nav__link">
    Auth in code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auth-in-workspace-requests" class="md-nav__link">
    Auth in workspace requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-requirements" class="md-nav__link">
    Network requirements
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="tre-api">TRE API</h1>
<p>The TRE API is a service that users can interact with to request changes to workspaces e.g., to create, update, delete workspaces and workspace services inside each workspace.</p>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="tools">Tools</h3>
<ul>
<li><a href="https://www.python.org/downloads/">Python</a> &gt;= 3.8 with <a href="https://packaging.python.org/tutorials/installing-packages/#ensure-you-can-run-pip-from-the-command-line">pip</a></li>
</ul>
<h3 id="azure-resources">Azure resources</h3>
<ul>
<li><a href="https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview">Application Insights</a> - Not required for testing locally</li>
<li><a href="https://docs.microsoft.com/azure/cosmos-db/introduction">Azure Cosmos DB</a> (SQL)<ul>
<li>You can use the <a href="https://docs.microsoft.com/azure/cosmos-db/local-emulator?tabs=cli%2Cssl-netstd21">Cosmos DB Emulator</a> for testing locally</li>
</ul>
</li>
<li><a href="https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview">Azure Service Bus</a></li>
<li>Service principal for the API to access Azure services such as Azure Service Bus</li>
<li>AAD applications (for the API and Swagger UI) - see <a href="../../tre-admins/auth/">Authentication &amp; authorization</a> for more information</li>
</ul>
<h4 id="creating-resources-bash">Creating resources (Bash)</h4>
<p>The following snippets can be used to create resources for local testing with Bash shell.</p>
<p>Sign in with Azure CLI:</p>
<div class="highlight"><pre><span></span><code>az login
az account list
az account set --subscription &lt;subscription ID&gt;
</code></pre></div>
<p>Provision Azure Service Bus:</p>
<div class="highlight"><pre><span></span><code><span class="nv">RESOURCE_GROUP</span><span class="o">=</span>&lt;resource group name&gt;
<span class="nv">LOCATION</span><span class="o">=</span>westeurope
<span class="nv">SERVICE_BUS_NAMESPACE</span><span class="o">=</span>&lt;service bus namespace name&gt;
<span class="nv">SERVICE_BUS_RESOURCE_REQUEST_QUEUE</span><span class="o">=</span>workspacequeue
<span class="nv">SERVICE_BUS_DEPLOYMENT_STATUS_UPDATE_QUEUE</span><span class="o">=</span>deploymentstatus

az servicebus namespace create --resource-group <span class="nv">$RESOURCE_GROUP</span> --name <span class="nv">$SERVICE_BUS_NAMESPACE</span> --location <span class="nv">$LOCATION</span>
az servicebus queue create --resource-group <span class="nv">$RESOURCE_GROUP</span> --namespace-name <span class="nv">$SERVICE_BUS_NAMESPACE</span> --name <span class="nv">$SERVICE_BUS_RESOURCE_REQUEST_QUEUE</span>
az servicebus queue create --resource-group <span class="nv">$RESOURCE_GROUP</span> --namespace-name <span class="nv">$SERVICE_BUS_NAMESPACE</span> --name <span class="nv">$SERVICE_BUS_DEPLOYMENT_STATUS_UPDATE_QUEUE</span>
</code></pre></div>
<p>Provision Azure Cosmos DB:</p>
<div class="highlight"><pre><span></span><code><span class="nv">COSMOS_NAME</span><span class="o">=</span>&lt;cosmos_name&gt;
<span class="nv">COSMOS_DB_NAME</span><span class="o">=</span>&lt;database_name&gt;

az cosmosdb create -n <span class="nv">$COSMOS_NAME</span> -g <span class="nv">$RESOURCE_GROUP</span> --locations <span class="nv">regionName</span><span class="o">=</span><span class="nv">$LOCATION</span>
az cosmosdb sql database create -a <span class="nv">$COSMOS_NAME</span> -g <span class="nv">$RESOURCE_GROUP</span> -n <span class="nv">$COSMOS_DB_NAME</span>
</code></pre></div>
<p><a href="https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli">Create a service principal</a> and assign it permissions to access Service Bus and Cosmos:</p>
<div class="highlight"><pre><span></span><code>az ad sp create-for-rbac --name &lt;service principal name&gt;

<span class="nv">SERVICE_PRINCIPAL_ID</span><span class="o">=</span>&lt;the AppId of the Service Principal&gt;
<span class="nv">SUBSCRIPTION_ID</span><span class="o">=</span><span class="k">$(</span>az account show --query id --output tsv<span class="k">)</span>

az role assignment create <span class="se">\</span>
    --role <span class="s2">&quot;Azure Service Bus Data Sender&quot;</span> <span class="se">\</span>
    --assignee <span class="nv">$SERVICE_PRINCIPAL_ID</span> <span class="se">\</span>
    --scope /subscriptions/<span class="nv">$SUBSCRIPTION_ID</span>/resourceGroups/<span class="nv">$RESOURCE_GROUP</span>/providers/Microsoft.ServiceBus/namespaces/<span class="nv">$SERVICE_BUS_NAMESPACE</span>

az role assignment create <span class="se">\</span>
    --role <span class="s2">&quot;Azure Service Bus Data Receiver&quot;</span> <span class="se">\</span>
    --assignee <span class="nv">$SERVICE_PRINCIPAL_ID</span> <span class="se">\</span>
    --scope /subscriptions/<span class="nv">$SUBSCRIPTION_ID</span>/resourceGroups/<span class="nv">$RESOURCE_GROUP</span>/providers/Microsoft.ServiceBus/namespaces/<span class="nv">$SERVICE_BUS_NAMESPACE</span>

az role assignment create <span class="se">\</span>
    --role <span class="s2">&quot;Contributor&quot;</span> <span class="se">\</span>
    --assignee <span class="nv">$SERVICE_PRINCIPAL_ID</span> <span class="se">\</span>
    --scope /subscriptions/<span class="nv">$SUBSCRIPTION_ID</span>/resourceGroups/<span class="nv">$RESOURCE_GROUP</span>/providers/Microsoft.DocumentDB/databaseAccounts/<span class="nv">$COSMOS_NAME</span>
</code></pre></div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Keep in mind that Azure role assignments may take up to five minutes to propagate.</p>
</div>
<h2 id="configuration">Configuration</h2>
<h3 id="general">General</h3>
<table>
<thead>
<tr>
<th><div style="width: 340px">Environment variable name</div></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DEBUG</code></td>
<td>When set to <code>True</code>, the debugging information for unhandled exceptions is shown in the Swagger UI and logging is more verbose.</td>
</tr>
<tr>
<td><code>TRE_ID</code></td>
<td>The Azure TRE instance name - used for deployment of resources (can be set to anything when debugging locally). Example value: <code>mytre-dev-3142</code></td>
</tr>
<tr>
<td><code>RESOURCE_LOCATION</code></td>
<td>The location (region) to deploy resources (e.g., workspaces) to. This can be set to anything as the deployment service is not called locally. Example value: <code>westeurope</code></td>
</tr>
</tbody>
</table>
<h3 id="authentication-and-authorization">Authentication and Authorization</h3>
<p>The TRE API depends on <a href="../../tre-admins/auth/#tre-api">TRE API</a> and <a href="../../tre-admins/auth/#tre-swagger-ui">TRE Swagger UI</a> app registrations. The API requires the environment variables listed in the table below to be present. See <a href="../../tre-admins/auth/">Authentication and authorization</a> for more information.</p>
<table>
<thead>
<tr>
<th><div style="width: 340px">Environment variable name</div></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AAD_TENANT_ID</code></td>
<td>The tenant ID of the Azure AD.</td>
</tr>
<tr>
<td><code>API_CLIENT_ID</code></td>
<td>The application (client) ID of the <a href="../../tre-admins/auth/#tre-api">TRE API</a> service principal.</td>
</tr>
<tr>
<td><code>API_CLIENT_SECRET</code></td>
<td>The application password (client secret) of the <a href="../../tre-admins/auth/#tre-api">TRE API</a> service principal.</td>
</tr>
<tr>
<td><code>SWAGGER_UI_CLIENT_ID</code></td>
<td>The application (client) ID of the <a href="../../tre-admins/auth/#tre-swagger-ui">TRE Swagger UI</a> service principal.</td>
</tr>
</tbody>
</table>
<p>See also: <a href="#auth-in-code">Auth in code</a></p>
<h3 id="state-store">State store</h3>
<table>
<thead>
<tr>
<th><div style="width: 340px">Environment variable name</div></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>STATE_STORE_ENDPOINT</code></td>
<td>The Cosmos DB endpoint. Use <code>localhost</code> with an emulator. Example value: <code>https://localhost:8081</code></td>
</tr>
<tr>
<td><code>STATE_STORE_KEY</code></td>
<td>The Cosmos DB key. Use only with localhost emulator.</td>
</tr>
<tr>
<td><code>COSMOSDB_ACCOUNT_NAME</code></td>
<td>The Cosmos DB account name.</td>
</tr>
<tr>
<td><code>SUBSCRIPTION_ID</code></td>
<td>The Azure Subscription ID where Cosmos DB is located.</td>
</tr>
<tr>
<td><code>RESOURCE_GROUP_NAME</code></td>
<td>The Azure Resource Group name where Cosmos DB is located.</td>
</tr>
</tbody>
</table>
<h3 id="service-bus">Service Bus</h3>
<table>
<thead>
<tr>
<th><div style="width: 340px">Environment variable name</div></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SERVICE_BUS_FULLY_QUALIFIED_NAMESPACE</code></td>
<td>Example value: <code>&lt;your namespace&gt;.servicebus.windows.net</code></td>
</tr>
<tr>
<td><code>SERVICE_BUS_RESOURCE_REQUEST_QUEUE</code></td>
<td>The queue for resource request messages sent by the API. Example value: <code>workspacequeue</code></td>
</tr>
<tr>
<td><code>SERVICE_BUS_DEPLOYMENT_STATUS_UPDATE_QUEUE</code></td>
<td>The queue for deployment status update messages sent by <a href="../resource-processor/">Resource Processor</a> and received by the API. Example value: <code>deploymentstatus</code></td>
</tr>
</tbody>
</table>
<h3 id="logging-and-monitoring">Logging and monitoring</h3>
<table>
<thead>
<tr>
<th><div style="width: 340px">Environment variable name</div></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>APPLICATIONINSIGHTS_CONNECTION_STRING</code></td>
<td>Application Insights connection string - can be left blank when debugging locally.</td>
</tr>
<tr>
<td><code>APPINSIGHTS_INSTRUMENTATIONKEY</code></td>
<td>Application Insights instrumentation key - can be left blank when debugging locally.</td>
</tr>
</tbody>
</table>
<h3 id="service-principal-for-api-process-identity">Service principal for API process identity</h3>
<table>
<thead>
<tr>
<th><div style="width: 340px">Environment variable name</div></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AZURE_SUBSCRIPTION_ID</code></td>
<td>Azure Subscription ID</td>
</tr>
<tr>
<td><code>AZURE_TENANT_ID</code></td>
<td>Azure Tenant ID</td>
</tr>
<tr>
<td><code>AZURE_CLIENT_ID</code></td>
<td>API Service Principal ID</td>
</tr>
<tr>
<td><code>AZURE_CLIENT_SECRET</code></td>
<td>API Service Principal Secret</td>
</tr>
</tbody>
</table>
<h2 id="running-the-api">Running the API</h2>
<h3 id="develop-and-run-locally">Develop and run locally</h3>
<ol>
<li>
<p>Install python dependencies (in a virtual environment)</p>
<div class="highlight"><pre><span></span><code>virtualenv venv
venv/Scripts/activate
pip install -r requirements.txt
</code></pre></div>
</li>
<li>
<p>Copy <code>.env.tmpl</code> in the <strong>api_app</strong> folder to <code>.env</code> and configure the variables. Notice: You might also need to export those variables to your env (<code>export VAR_NAME=VALUE</code> for all vars in the .env file).</p>
</li>
<li>Start the web API<div class="highlight"><pre><span></span><code>cd api_app
uvicorn main:app --reload
</code></pre></div>
</li>
</ol>
<p>The API endpoints documentation and the Swagger UI will be available at <a href="https://localhost:8000/api/docs">https://localhost:8000/api/docs</a>.</p>
<h3 id="develop-and-run-in-a-dev-container">Develop and run in a dev container</h3>
<ol>
<li>Open the project in Visual Studio Code in the DevContainer</li>
<li>Copy <code>.env.sample</code> in the <strong>api_app</strong> folder to <code>.env</code> and configure the variables</li>
<li>Start the web API<div class="highlight"><pre><span></span><code>cd api_app
pip install -r requirements.txt
pip install -r requirements-dev.txt
uvicorn main:app --reload
</code></pre></div>
</li>
</ol>
<p>The API endpoints documentation and the Swagger UI will be available at <a href="https://localhost:8000/api/docs">https://localhost:8000/api/docs</a>.</p>
<h3 id="deploy-with-docker">Deploy with Docker</h3>
<p>You must have Docker and Docker Compose tools installed, and an Azure Cosmos DB configured in <code>.env</code> as described above.</p>
<p>Then run:</p>
<div class="highlight"><pre><span></span><code>cd api_app
docker compose up -d app
</code></pre></div>
<p>The API will be available at <a href="https://localhost:8000/api">https://localhost:8000/api</a> in your browser.</p>
<h2 id="unit-tests">Unit tests</h2>
<p>The unit tests are written with pytest and located in folder <code>/api_app/tests_ma/</code>.</p>
<p>Run all unit tests with the following command in the root folder of the repository:</p>
<div class="highlight"><pre><span></span><code>pytest --ignore=e2e_tests
</code></pre></div>
<h2 id="api-application-folder-structure">API application folder structure</h2>
<div class="highlight"><pre><span></span><code>api_app
├── api              - API implementation
│   ├── dependencies - Dependencies for routes definition
│   ├── errors       - Definitions of error handlers
│   └── routes       - Web routes (API endpoints)
│
├── core             - Application configuration, startup events, logging
│
├── db               - Database related implementation
│   ├── migrations   - Manually written alembic migrations
│   └── repositories - All CRUD features
│
├── models           - Pydantic models for this application
│   ├── domain       - Main models that are used almost everywhere
│   └── schemas      - Schemas for using in web routes
│
├── resources        - Strings that are used e.g., in web responses
│
├── services         - Logic that is not only CRUD related
│
├── tests_ma         - Unit tests
│
└── main.py          - FastAPI application creation and configuration
</code></pre></div>
<h2 id="auth-in-code">Auth in code</h2>
<p>The bulk of the authentication and authorization (A&amp;A) related code of the API is located in <code>/api_app/services/</code> folder. The A&amp;A code has an abstract base for enabling the possibility to add additional A&amp;A service providers. The Azure Active Directory (AAD) specific implementation is derived as follows:</p>
<div class="highlight"><pre><span></span><code>AccessService (access_service.py) &lt;─── AADAccessService (api_app/services/aad_authentication.py)

fastapi.security.OAuth2AuthorizationCodeBearer &lt;─── AccessService (access_service.py)
</code></pre></div>
<p>All the sensitive routes (API calls that can query sensitive data or modify resources) in the TRE API depend on having a "current user" authenticated. E.g., in <code>/api_app/api/routes/workspaces.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">(</span><span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)])</span>
</code></pre></div>
<p>Where <code>APIRouter</code> is part of the <a href="https://fastapi.tiangolo.com/">FastAPI</a>.</p>
<p>The user details, once authenticated, are stored as an instance of the custom <code>User</code> class.</p>
<h2 id="auth-in-workspace-requests">Auth in workspace requests</h2>
<p>Some workspace routes require <code>authConfig</code> field in the request body. The AAD specific implementation expects a dictionary inside <code>data</code> field to contain the application (client) ID of the <a href="../../tre-admins/auth/#workspaces">app registration associated with workspace</a>:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;authConfig&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;provider&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AAD&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;app_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c36f2ee3-8ec3-4431-9240-b1c0a0eb80a0&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The app registration for a workspace is not created by the API. One needs to be present (created manually) before using the API to provision a new workspace.</p>
</div>
<h2 id="network-requirements">Network requirements</h2>
<p>To be able to run the TRE API it needs to access the following resource outside the Azure TRE VNET via explicit allowed <a href="https://docs.microsoft.com/en-us/azure/virtual-network/service-tags-overview">Service Tags</a> or URLs.</p>
<table>
<thead>
<tr>
<th>Service Tag / Destination</th>
<th>Justification</th>
</tr>
</thead>
<tbody>
<tr>
<td>AzureActiveDirectory</td>
<td>Authenticate with the User Assigned identity to access Azure Cosmos DB and Azure Service Bus.</td>
</tr>
<tr>
<td>AzureResourceManager</td>
<td>To perform control plane operations, such as create database in State Store.</td>
</tr>
<tr>
<td>AzureContainerRegistry</td>
<td>Pull the TRE API container image, as it is located in Azure Container Registry.</td>
</tr>
<tr>
<td>graph.microsoft.com</td>
<td>Lookup role assignments for Azure Active Directory user, to only show TRE resources and user has access to.</td>
</tr>
</tbody>
</table>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: TRE Developers" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              TRE Developers
            </div>
          </div>
        </a>
      
      
        
        <a href="../resource-processor/" class="md-footer__link md-footer__link--next" aria-label="Next: Resource Processor" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Resource Processor
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
    
  </body>
</html>