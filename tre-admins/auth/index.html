
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Azure TRE">
      
      
        <meta name="author" content="Microsoft">
      
      
        <link rel="canonical" href="https://github.com/microsoft/AzureTRE/tre-admins/auth/">
      
      <link rel="icon" href="../../assets/ms_icon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.6">
    
    
      
        <title>Authentication and Authorization - Azure TRE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "7gescazz1m");
</script>

    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authentication-and-authorization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Azure TRE" class="md-header__button md-logo" aria-label="Azure TRE" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azure TRE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authentication and Authorization
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/AzureTre/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Azure TRE" class="md-nav__button md-logo" aria-label="Azure TRE" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    Azure TRE
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/AzureTre/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../..">Azure TRE Overview</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Azure TRE Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Azure TRE Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/user-roles/" class="md-nav__link">
        User Roles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/networking/" class="md-nav__link">
        Network Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/tre-resources-breakdown/" class="md-nav__link">
        Azure Resource Breakdown
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_6" type="checkbox" id="__nav_1_6" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_1_6">
          Shared Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Shared Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_6">
          <span class="md-nav__icon md-icon"></span>
          Shared Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/shared-services/gitea/" class="md-nav__link">
        Gitea (Source Mirror)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-tre-overview/shared-services/nexus/" class="md-nav__link">
        Nexus (Package Mirror)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          TRE Admins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TRE Admins" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          TRE Admins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Setup Instructions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setup Instructions" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Setup Instructions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/getting-started/" class="md-nav__link">
        1. Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/pre-deployment-steps/" class="md-nav__link">
        2. Pre-deployment Steps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/deploying-azure-tre/" class="md-nav__link">
        3. Deploying Azure TRE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/workflows/" class="md-nav__link">
        3b. Deploying Azure TRE with GitHub workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/configuring-shared-services/" class="md-nav__link">
        4. Configuring Shared Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/installing-base-workspace/" class="md-nav__link">
        5. Installing Base Workspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-instructions/installing-workspace-service-and-user-resource/" class="md-nav__link">
        6. Installing Workspace Service and User Resource
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../start-stop/" class="md-nav__link">
        Start-stop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tear-down/" class="md-nav__link">
        Tear-down
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../environment-variables/" class="md-nav__link">
        Environment Variables
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Authentication and Authorization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Authentication and Authorization
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app-registrations" class="md-nav__link">
    App registrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-registration-script" class="md-nav__link">
    App registration script
  </a>
  
    <nav class="md-nav" aria-label="App registration script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tre-api-swagger-and-automation-account" class="md-nav__link">
    TRE API, Swagger and Automation Account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workspace-applications" class="md-nav__link">
    Workspace Applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-deployment" class="md-nav__link">
    Manual Deployment
  </a>
  
    <nav class="md-nav" aria-label="Manual Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tre-api" class="md-nav__link">
    TRE API
  </a>
  
    <nav class="md-nav" aria-label="TRE API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-permissions-tre-api" class="md-nav__link">
    API permissions - TRE API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scopes-tre-api" class="md-nav__link">
    Scopes - TRE API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-roles-tre-api" class="md-nav__link">
    App roles - TRE API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-tre-api" class="md-nav__link">
    Authentication - TRE API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tre-swagger-ui" class="md-nav__link">
    TRE Swagger UI
  </a>
  
    <nav class="md-nav" aria-label="TRE Swagger UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-permissions-tre-swagger-ui" class="md-nav__link">
    API permissions - TRE Swagger UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-tre-swagger-ui" class="md-nav__link">
    Authentication - TRE Swagger UI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workspaces" class="md-nav__link">
    Workspaces
  </a>
  
    <nav class="md-nav" aria-label="Workspaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-workspaces" class="md-nav__link">
    Authentication - Workspaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-permissions-workspaces" class="md-nav__link">
    API permissions - Workspaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-roles" class="md-nav__link">
    App roles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tre-e2e-test" class="md-nav__link">
    TRE e2e test
  </a>
  
    <nav class="md-nav" aria-label="TRE e2e test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-permissions-tre-e2e-test" class="md-nav__link">
    API permissions - TRE e2e test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-tre-e2e-test" class="md-nav__link">
    Authentication - TRE e2e test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-to-end-test-user" class="md-nav__link">
    End-to-end test user
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-users" class="md-nav__link">
    Enabling users
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../registering-templates/" class="md-nav__link">
        Registering Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting-guide/" class="md-nav__link">
        Troubleshooting Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../tre-developers/">TRE Developers</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="TRE Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          TRE Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-developers/api/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-developers/resource-processor/" class="md-nav__link">
        Resource Processor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-developers/end-to-end-tests/" class="md-nav__link">
        End to End Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          TRE Workspace Authors
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TRE Workspace Authors" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          TRE Workspace Authors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-workspace-authors/authoring-workspace-templates/" class="md-nav__link">
        Authoring Workspace Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-workspace-authors/firewall-rules/" class="md-nav__link">
        Firewall Rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Templates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Templates" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Templates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Workspaces
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workspaces" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Workspaces
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspaces/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspaces/inner-eye/" class="md-nav__link">
        InnerEye
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Workspace Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workspace Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Workspace Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/azure-ml/" class="md-nav__link">
        Azure ML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/dev-test-labs/" class="md-nav__link">
        DevTest Labs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/gitea/" class="md-nav__link">
        Gitea
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/guacamole/" class="md-nav__link">
        Guacamole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/workspace-services/inner-eye/" class="md-nav__link">
        InnerEye
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3">
          User Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Resources" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          User Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/user-resources/guacamole-windows-vm/" class="md-nav__link">
        Guacamole Windows VM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tre-templates/user-resources/guacamole-linux-vm/" class="md-nav__link">
        Guacamole Linux VM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app-registrations" class="md-nav__link">
    App registrations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-registration-script" class="md-nav__link">
    App registration script
  </a>
  
    <nav class="md-nav" aria-label="App registration script">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tre-api-swagger-and-automation-account" class="md-nav__link">
    TRE API, Swagger and Automation Account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workspace-applications" class="md-nav__link">
    Workspace Applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manual-deployment" class="md-nav__link">
    Manual Deployment
  </a>
  
    <nav class="md-nav" aria-label="Manual Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tre-api" class="md-nav__link">
    TRE API
  </a>
  
    <nav class="md-nav" aria-label="TRE API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-permissions-tre-api" class="md-nav__link">
    API permissions - TRE API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scopes-tre-api" class="md-nav__link">
    Scopes - TRE API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-roles-tre-api" class="md-nav__link">
    App roles - TRE API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-tre-api" class="md-nav__link">
    Authentication - TRE API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tre-swagger-ui" class="md-nav__link">
    TRE Swagger UI
  </a>
  
    <nav class="md-nav" aria-label="TRE Swagger UI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-permissions-tre-swagger-ui" class="md-nav__link">
    API permissions - TRE Swagger UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-tre-swagger-ui" class="md-nav__link">
    Authentication - TRE Swagger UI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workspaces" class="md-nav__link">
    Workspaces
  </a>
  
    <nav class="md-nav" aria-label="Workspaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-workspaces" class="md-nav__link">
    Authentication - Workspaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-permissions-workspaces" class="md-nav__link">
    API permissions - Workspaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app-roles" class="md-nav__link">
    App roles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tre-e2e-test" class="md-nav__link">
    TRE e2e test
  </a>
  
    <nav class="md-nav" aria-label="TRE e2e test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-permissions-tre-e2e-test" class="md-nav__link">
    API permissions - TRE e2e test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication-tre-e2e-test" class="md-nav__link">
    Authentication - TRE e2e test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-to-end-test-user" class="md-nav__link">
    End-to-end test user
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enabling-users" class="md-nav__link">
    Enabling users
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="authentication-and-authorization">Authentication and authorization</h1>
<p><a href="https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis">Azure Active Directory (AAD)</a> is the backbone of Authentication and Authorization in the Trusted Research Environment.</p>
<p>AAD holds the identities of all the TRE/workspace users, including administrators, and connects the identities with applications which define the permissions for each user role.</p>
<h2 id="app-registrations">App registrations</h2>
<p>App registrations (represented by service principals) define the various access permissions to the TRE system. There are a total of four main Applications of interest.</p>
<table>
<thead>
<tr>
<th>AAD Application</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TRE API application</td>
<td>This is the main application and used to authenticate access to the <a href="../../tre-developers/api/">TRE API</a>.</td>
</tr>
<tr>
<td>TRE Swagger UI</td>
<td>This is used to authenticate identities who wish to use the Swagger UI</td>
</tr>
<tr>
<td>Automation App</td>
<td>This application is created so that you can run the  tests or any CI/CD capability. This is particularly important if your tenant is MFA enabled.</td>
</tr>
<tr>
<td>Workspace API</td>
<td>Typically you would have an application securing one or more workspaces that are created by TRE.</td>
</tr>
</tbody>
</table>
<p>Some of the applications require <strong>admin consent</strong> to allow them to validate users against the AAD. Check the Microsoft Docs on <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/configure-admin-consent-workflow">Configure the admin consent workflow</a> on how to request admin consent and handle admin consent requests.</p>
<p>You can create these applications manually, but <code>/scripts/aad-app-reg.sh</code>  does the heavy lifting for you. Should you wish to create these manually via the <a href="https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app">Azure Portal</a>. The requirements are defined <a href="#Manual-Deployment">below</a>.</p>
<h2 id="app-registration-script">App registration script</h2>
<h3 id="tre-api-swagger-and-automation-account">TRE API, Swagger and Automation Account</h3>
<p>The <code>/scripts/aad-app-reg.sh</code> script automatically sets up the app registrations with the required permissions to run Azure TRE. It will create and configure all of the app registrations depending on the parameters. You would typically run this script twice; once for the <strong>TRE API</strong> and once for each <strong>Workspace</strong>.</p>
<p>Example on how to run the script:</p>
<div class="highlight"><pre><span></span><code>./aad-app-reg.sh <span class="se">\</span>
    --name &lt;TRE_ID&gt; <span class="se">\</span>
    --swaggerui-redirecturl https://&lt;TRE_ID&gt;.&lt;Azure location&gt;.cloudapp.azure.com/api/docs/oauth2-redirect <span class="se">\</span>
    --admin-consent <span class="se">\</span>
    --automation-account
</code></pre></div>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--name</code></td>
<td>The prefix of the name of the app registrations. <code>TRE</code> will give you <code>TRE API</code> and <code>TRE Swagger UI</code>.</td>
</tr>
<tr>
<td><code>--swaggerui-redirecturl</code></td>
<td>The reply URL for the Swagger UI app. Use the values of the <a href="../environment-variables/">environment variables</a> <code>TRE_ID</code> and <code>LOCATION</code> in the URL. Reply URL for the localhost, <code>http://localhost:8000/api/docs/oauth2-redirect</code>, will be added by default.</td>
</tr>
<tr>
<td><code>--admin-consent</code></td>
<td>Grants admin consent for the app registrations. This is required for them to function properly, but requires AAD admin privileges.</td>
</tr>
<tr>
<td><code>--automation-account</code></td>
<td>This is an optional parameter but will create an application with test users with permission to use the <code>TRE API</code> and <code>TRE Swagger UI</code></td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The script will create an app password (client secret) for the <strong>TRE API</strong> app and the <strong>Automation App</strong> and tell you to copy these to the <code>/templates/core/.env</code> file. These values are only shown once, if you lose them, the script will create new secrets if run again.</p>
</div>
<p>If you do not wish to create an Automation App, just remove the <code>--automation-account</code> from the command.</p>
<h3 id="workspace-applications">Workspace Applications</h3>
<p>Access to workspaces is also controlled using app registrations - one per workspace. The configuration of the app registration depends on the nature of the workspace, but this section covers the typical minimum settings.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The app registration for a workspace is not created by the <a href="../../tre-developers/api/">API</a>. One needs to be present before using the API to provision a new workspace. The same script can be used to create the <strong>Workspace Application</strong>.</p>
</div>
<p>Example on how to run the script:</p>
<div class="highlight"><pre><span></span><code>./aad-app-reg.sh <span class="se">\</span>
    --name <span class="s1">&#39;&lt;TRE_ID&gt; - Workspace 1&#39;</span> <span class="se">\</span>
    --workspace <span class="se">\</span>
    --swaggerui-clientid &lt;SWAGGER_UI_CLIENT_ID&gt; <span class="se">\</span>
    --admin-consent <span class="se">\</span>
    --automation-clientid &lt;TEST_ACCOUNT_CLIENT_ID&gt;
</code></pre></div>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--name</code></td>
<td>The name of the application. This will be suffixed with 'API' by the script.</td>
</tr>
<tr>
<td><code>--workspace</code></td>
<td>This tells the script to create you are creating a workspace app rather than the TRE API app.</td>
</tr>
<tr>
<td><code>--swaggerui-clientid</code></td>
<td>This value is one of the outputs when you first ran the script. It is mandatory if you use admin-consent.</td>
</tr>
<tr>
<td><code>--admin-consent</code></td>
<td>Grants admin consent for the app registrations. This is required for them to function properly, but requires AAD admin privileges.</td>
</tr>
<tr>
<td><code>--automation-clientid</code></td>
<td>This is an optional parameter but will grant the Automation App (created in step 1) permission to the new workspace app.</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The script will create an app password (client secret) for the workspace and tell you to copy these to the <code>/templates/core/.env</code> file. These values are only shown once, if you lose them, the script will create new secrets if run again.</p>
</div>
<p>If you do not wish to create an Automation App, just remove the <code>--automation-clientid</code> from the command.</p>
<h2 id="manual-deployment">Manual Deployment</h2>
<h3 id="tre-api">TRE API</h3>
<p>The <strong>TRE API</strong> app registration defines the permissions, scopes and app roles for API users to authenticate and authorize API calls.</p>
<h4 id="api-permissions-tre-api">API permissions - TRE API</h4>
<table>
<thead>
<tr>
<th>API/permission name</th>
<th>Type</th>
<th>Description</th>
<th>Admin consent required</th>
<th>Status</th>
<th>TRE usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft Graph/Directory.Read.All (<code>https://graph.microsoft.com/Directory.Read.All</code>)</td>
<td>Application*</td>
<td>Allows the app to read data in your organization's directory, such as users, groups and apps, without a signed-in user.</td>
<td>Yes</td>
<td>Granted for <em>[directory name]</em></td>
<td>Used e.g., to retrieve app registration details, user associated app roles etc.</td>
</tr>
<tr>
<td>Microsoft Graph/User.Read.All (<code>https://graph.microsoft.com/User.Read.All</code>)</td>
<td>Application*</td>
<td>Allows the app to read user profiles without a signed in user.</td>
<td>Yes</td>
<td>Granted for <em>[directory name]</em></td>
<td>Reading user role assignments to check that the user has permissions to execute an action e.g., to view workspaces. See <code>/api_app/services/aad_authentication.py</code>.</td>
</tr>
</tbody>
</table>
<p>*) See the difference between <a href="https://docs.microsoft.com/graph/auth/auth-concepts#delegated-and-application-permissions">delegated and application permission</a> types.</p>
<p>See <a href="https://docs.microsoft.com/graph/permissions-reference">Microsoft Graph permissions reference</a> for more details.</p>
<h4 id="scopes-tre-api">Scopes - TRE API</h4>
<ul>
<li><code>api://&lt;Application (client) ID&gt;/</code> <strong><code>user_impersonation</code></strong> - Allow the app to access the TRE API on behalf of the signed-in user</li>
</ul>
<h4 id="app-roles-tre-api">App roles - TRE API</h4>
<table>
<thead>
<tr>
<th>Display name</th>
<th>Description</th>
<th>Allowed member types</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>TRE Administrators</td>
<td>Provides resource administrator access to the TRE.</td>
<td>Users/Groups,Applications</td>
<td><code>TREAdmin</code></td>
</tr>
<tr>
<td>TRE Users</td>
<td>Provides access to the TRE application.</td>
<td>Users/Groups,Applications</td>
<td><code>TREUser</code></td>
</tr>
</tbody>
</table>
<h4 id="authentication-tre-api">Authentication - TRE API</h4>
<p>The <strong>TRE API</strong> app registration requires no redirect URLs defined or anything else for that matter. From a security standpoint it should be noted that public client flows should not be allowed. As the identity of the client application cannot be verified (see the image below taken from app registration authentication blade in Azure Portal).</p>
<p><img alt="Allow public client flows - No" src="../../assets/app-reg-authentication-allow-public-client-flows-no.png" /></p>
<h3 id="tre-swagger-ui">TRE Swagger UI</h3>
<p><strong>TRE Swagger UI</strong> app registration:</p>
<ul>
<li>Controls the access to the Swagger UI of the TRE API</li>
<li>Has no scopes or app roles defined</li>
</ul>
<h4 id="api-permissions-tre-swagger-ui">API permissions - TRE Swagger UI</h4>
<table>
<thead>
<tr>
<th>API/permission name</th>
<th>Type</th>
<th>Description</th>
<th>Admin consent required</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft Graph/offline_access (<code>https://graph.microsoft.com/offline_access</code>)</td>
<td>Delegated*</td>
<td>Allows the app to see and update the data you gave it access to, even when users are not currently using the app.</td>
<td>No</td>
<td>Granted for <em>[directory name]</em></td>
</tr>
<tr>
<td>Microsoft Graph/openid (<code>https://graph.microsoft.com/openid</code>)</td>
<td>Delegated*</td>
<td>Allows users to sign in to the app with their work or school accounts and allows the app to see basic user profile information.</td>
<td>No</td>
<td>Granted for <em>[directory name]</em></td>
</tr>
<tr>
<td>TRE API/user_impersonation (<code>api://&lt;TRE API Application (client) ID&gt;/user_impersonation</code>)</td>
<td>Delegated*</td>
<td>See <a href="#scopes---tre-api">TRE API app registration scopes</a>.</td>
<td>No</td>
<td>Granted for <em>[directory name]</em></td>
</tr>
</tbody>
</table>
<p>*) See the difference between <a href="https://docs.microsoft.com/graph/auth/auth-concepts#delegated-and-application-permissions">delegated and application permission</a> types.</p>
<h4 id="authentication-tre-swagger-ui">Authentication - TRE Swagger UI</h4>
<p>Redirect URLs:</p>
<ul>
<li><code>https://&lt;TRE ID&gt;.&lt;Azure location&gt;.cloudapp.azure.com/docs/oauth2-redirect</code></li>
<li><code>http://localhost:8000/docs/oauth2-redirect</code> - For local testing</li>
</ul>
<h3 id="workspaces">Workspaces</h3>
<h4 id="authentication-workspaces">Authentication - Workspaces</h4>
<p>Same as <a href="#authentication-tre-api">TRE API</a>.</p>
<h4 id="api-permissions-workspaces">API permissions - Workspaces</h4>
<table>
<thead>
<tr>
<th>API/permission name</th>
<th>Type</th>
<th>Description</th>
<th>Admin consent required</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft Graph/User.Read (<code>https://graph.microsoft.com/User.Read</code>)</td>
<td>Delegated</td>
<td>Allows users to sign-in to the app, and allows the app to read the profile of signed-in users. It also allows the app to read basic company information of signed-in users.</td>
<td>No</td>
</tr>
<tr>
<td>Workspace API/user_impersonation (<code>api://&lt;Workspace API Application (client) ID&gt;/user_impersonation</code>)</td>
<td>Delegated*</td>
<td>Allows the app to access the workspace API on behalf of the user</td>
<td>No</td>
</tr>
</tbody>
</table>
<h4 id="app-roles">App roles</h4>
<table>
<thead>
<tr>
<th>Display name</th>
<th>Description</th>
<th>Allowed member types</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Owners</td>
<td>Provides ownership access to workspace.</td>
<td>Users/Groups</td>
<td><code>WorkspaceOwner</code></td>
</tr>
<tr>
<td>Researchers</td>
<td>Provides access to workspace.</td>
<td>Users/Groups</td>
<td><code>WorkspaceResearcher</code></td>
</tr>
</tbody>
</table>
<h3 id="tre-e2e-test">TRE e2e test</h3>
<p>The <strong>TRE Automation Admin App</strong> registration is used to authorize end-to-end test scenarios.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>This app registration is only needed and used for <strong>testing</strong></li>
</ul>
</div>
<h4 id="api-permissions-tre-e2e-test">API permissions - TRE e2e test</h4>
<table>
<thead>
<tr>
<th>API/permission name</th>
<th>Type</th>
<th>Description</th>
<th>Admin consent required</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft Graph/openid (<code>https://graph.microsoft.com/openid</code>)</td>
<td>Delegated</td>
<td>Allows users to sign in to the app with their work or school accounts and allows the app to see basic user profile information.</td>
<td>No</td>
</tr>
<tr>
<td>Microsoft Graph/User.Read (<code>https://graph.microsoft.com/User.Read</code>)</td>
<td>Delegated</td>
<td>Allows users to sign-in to the app, and allows the app to read the profile of signed-in users. It also allows the app to read basic company information of signed-in users.</td>
<td>No</td>
</tr>
<tr>
<td><TRE APP client>.user_impersonation</td>
<td>Delegated</td>
<td>Allow the app access the TRE API on behalf of the signed-in user</td>
<td>No</td>
</tr>
</tbody>
</table>
<h4 id="authentication-tre-e2e-test">Authentication - TRE e2e test</h4>
<ol>
<li>
<p>Define Redirect URLs:</p>
<p>In the <strong>TRE e2e test</strong> app registration go to Authentication -&gt; Add platform -&gt; Select Mobile &amp; Desktop and add:</p>
<div class="highlight"><pre><span></span><code>https://login.microsoftonline.com/common/oauth2/nativeclient
msal&lt;TRE e2e test app registration application (client) ID&gt;://auth
</code></pre></div>
<p><img alt="Add auth platform" src="../../assets/aad-add-auth-platform.png" /></p>
</li>
<li>
<p>Allow public client flows (see the image below). This enables the end-to-end tests to use a username and password combination to authenticate.</p>
<p><img alt="Allow public client flows - Yes" src="../../assets/app-reg-authentication-allow-public-client-flows-yes.png" /></p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>OAuth 2.0 Public client flow cannot verify the the client application identity, it should only be enabled if needed.</p>
</div>
<h4 id="end-to-end-test-user">End-to-end test user</h4>
<p>The end-to-end test authentication and authorization is done via a dummy user, using its username and password, dedicated just for running the tests.</p>
<p>The user is linked to the application (app registration) the same way as any other users (see <a href="#enabling-users">Enabling users</a>).</p>
<p>The end-to-end test should be added to <strong>TRE Administrator</strong> role exposed by the <strong>TRE API</strong> application, and to the <strong>Owners</strong> role exposed by the Workspaces application.</p>
<h3 id="enabling-users">Enabling users</h3>
<p>For a user to gain access to the system, they have to:</p>
<ol>
<li>Have an identity in Azure AD</li>
<li>Be linked with an app registration and assigned a role</li>
</ol>
<p>When these requirements are met, the user can sign-in using their credentials and use their privileges to use the API, login to workspace environment etc. based on their specific roles.</p>
<p><img alt="User linked with app registrations" src="../../assets/aad-user-linked-with-app-regs.png" /></p>
<p>The users can also be linked via the Enterprise application view:</p>
<p><img alt="Adding users to Enterprise application" src="../../assets/adding-users-to-enterprise-application.png" /></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../environment-variables/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Environment Variables" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Environment Variables
            </div>
          </div>
        </a>
      
      
        
        <a href="../registering-templates/" class="md-footer__link md-footer__link--next" aria-label="Next: Registering Templates" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Registering Templates
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
    
  </body>
</html>